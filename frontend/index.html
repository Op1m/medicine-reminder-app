<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Medicine Reminder — Demo Telegram Login</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <h1>Medicine Reminder — Telegram WebApp Demo</h1>
  <div id="status">Инициализация...</div>
  <button id="loginBtn">Login via Telegram (send initData)</button>

  <script>
    const BACKEND = 'https://medicine-reminder-app-t3u9.onrender.com'; 
    function init(){
      if (window.Telegram && Telegram.WebApp) {
        document.getElementById('status').innerText = 'Telegram WebApp ready';
      } else {
        document.getElementById('status').innerText = 'Open this page inside Telegram (WebApp)';
      }
    }
    init();

    document.getElementById('loginBtn').addEventListener('click', async ()=>{
      const initData = window.Telegram.WebApp.initData;
      console.log('initData=', initData);
      const resp = await fetch(BACKEND + '/auth/telegram', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ initData })
      });
      const json = await resp.json();
      console.log(json);
      if (resp.ok) {
        localStorage.setItem('token', json.token);
        document.getElementById('status').innerText = 'Logged as ' + json.user.username;
      } else {
        document.getElementById('status').innerText = 'Auth failed: ' + JSON.stringify(json);
      }
    });
  </script>
</body>
</html>