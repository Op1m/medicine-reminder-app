<script>
    const BACKEND = 'https://medicine-reminder-app-t3u9.onrender.com'; // твой render URL

    function setStatus(t){ document.getElementById('status').innerText = t; }

    async function sendInitData(initData){
        setStatus('Авторизация...');
        try {
            const res = await fetch(BACKEND + '/api/auth/telegram', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ initData: initData })
            });
            const json = await res.json().catch(()=>null);
            if (!res.ok) {
                setStatus('Auth failed: ' + (json?.error || res.status + ' ' + res.statusText));
                console.log('Server response (non-ok):', res.status, json);
                return;
            }
            localStorage.setItem('token', json.token);
            setStatus('Вход успешен: ' + (json.user?.username || json.user?.firstName));
        } catch (e) {
            console.error(e);
            setStatus('Ошибка сети при auth');
        }
    }

    document.getElementById('loginBtn').addEventListener('click', async ()=> {
        const initData = (window.Telegram && Telegram.WebApp) ? Telegram.WebApp.initData : undefined;
        console.log('initData (from Telegram.WebApp):', initData);
        if (!initData) {
            setStatus('initData не найден. Откройте страницу через кнопку бота в Telegram (Web App).');
            return;
        }
        await sendInitData(initData);
    });
</script>
